# Primer on Latency and Bandwidth

네트워크 성능의 두 가지 핵심 요소인 `지연 시간`과 `대역폭`에 대한 설명

## 속도는 중요한 기능이다 (Speed is a feature)

웹 성능 최적화(WPO, web performance optimization) 산업의 급성장은 웹사이트 속도가 사용자 경험에 미치는 영향을 강조합니다.
속도는 단순한 심리적 요소가 아니라 다음과 같은 실질적인 영향을 미칩니다.

- Faster sites lead to better user engagement.
- Faster sites lead to better user retention.
- Faster sites lead to higher conversions.

이처럼 속도는 웹사이트나 애플리케이션에서 필수적인 요소가 되었으며, 이를 개선하기 위해서는 지연 시간과 대역폭을 이해하는 것이 중요합니다.

- 지연 시간(Latency): 데이터 패킷이 출발지에서 목적지까지 도달하는 데 걸리는 시간
- 대역폭(Bandwidth): 특정 시간 동안 전송할 수 있는 데이터의 최대 양

![latency_and_bandwith](https://hpbn.co/assets/diagrams/9f12afe5ca29ba5c2ad555fcee5bd568.svg)

### 대서양 횡단 지연 시간 단축: 하이버니아 익스프레스 (Decreasing Transatlantic Latency with Hibernia Express)

특정 산업에서는 지연 시간이 매우 중요한 요소입니다.
예를 들어, **고빈도 주식 거래(HFT, High-Frequency Trading)**에서는 밀리초(ms) 단위의 차이가 큰 수익 또는 손실로 이어질 수 있습니다.

> 뉴욕에 증권사가 많은 이유가?

이를 위해 2015년 9월, 하이버니아 네트워크(Hibernia Networks)는 **하이버니아 익스프레스(Hibernia Express)**라는 대서양 횡단 광케이블을 개통했습니다.

- 뉴욕 – 런던 간 최소 지연 시간: 58.95ms
- 기존 케이블 대비 5ms 단축
- 총 투자 비용: 3억 달러(약 4조 원)
- 밀리초당 투자 비용: 약 6천만 달러

이처럼, 지연 시간을 줄이는 것이 비즈니스적으로 매우 큰 가치를 가지는 경우도 있습니다.

## 지연 시간의 주요 요소 (The Many Components of Latency)

지연 시간은 다음과 같은 여러 요소로 구성됩니다.

1. 전파 지연 (Propagation Delay)

   - 신호가 출발지에서 목적지까지 이동하는 데 걸리는 시간
   - 거리에 따라 결정되며, 신호의 전파 속도(광섬유에서는 빛의 속도)에 의해 제한됨

2. 전송 지연 (Transmission Delay)

   - 패킷의 모든 비트가 네트워크에 전송되는 데 걸리는 시간
   - 패킷 크기와 네트워크 속도(대역폭)에 따라 결정됨

3. 처리 지연 (Processing Delay)

   - 패킷 헤더를 분석하고, 오류를 확인하며, 다음 전송 경로를 결정하는 데 걸리는 시간

4. 큐잉 지연 (Queuing Delay)

   - 네트워크 트래픽이 많을 경우, 패킷이 전송되기 전에 대기하는 시간

💡 총 지연 시간 = 전파 지연 + 전송 지연 + 처리 지연 + 큐잉 지연

예를 들어, 뉴욕과 런던 사이의 광섬유 케이블을 통해 신호가 이동할 때, 이론적으로 빛의 속도는 300,000km/s이지만, 실제 광섬유 속도는 약 200,000km/s입니다.
따라서 거리(약 5,600km)를 고려하면 **최소** 전파 지연은 약 28ms가 됩니다.

### Note

네트워크 데이터 전송 속도는 일반적으로 초당 비트 수(bps)로 측정되며, 비네트워크 장비의 데이터 전송 속도는 일반적으로 초당 바이트 수(Bps)로 표시됩니다. 이는 혼동의 일반적인 원인이므로, 단위를 주의 깊게 확인해야 합니다. 예를 들어, 10메가바이트(MB) 파일을 1Mbps 링크를 통해 "전송"하려면 80초가 필요합니다. 10MB는 80Mb와 동일하며, 이는 1바이트당 8비트이기 때문입니다.

## 빛의 속도와 전파 지연 시간 (Speed of Light and Propagation Latency)

네트워크에서 신호는 전기적 또는 광학적 형태로 전송되며, 이는 전파 지연 시간에 영향을 미칩니다. 전파 지연 시간은 신호가 송신자에서 수신자까지 이동하는 데 걸리는 시간으로, 거리와 신호의 전파 속도에 의해 결정됩니다.

이론적으로, 진공에서 빛의 속도는 약 299,792km/s입니다. 그러나 실제 네트워크에서는 신호가 광섬유 케이블과 같은 매체를 통해 전송되며, 이러한 매체의 굴절률로 인해 빛의 속도는 약간 감소합니다. 예를 들어, 광섬유의 굴절률은 약 1.5로, 이는 빛의 속도가 약 200,000km/s로 감소함을 의미합니다.

![signal latencies](img/signal_latencies.png)

전파 지연 시간을 계산하기 위해서는 송신자와 수신자 간의 거리를 빛의 속도로 나누면 됩니다. 예를 들어, 2,000km 떨어진 두 지점 간의 전파 지연 시간은 약 10ms입니다.

그러나 실제 네트워크에서는 신호가 여러 라우터와 스위치를 거치며, 각 장비에서 처리 지연과 큐잉 지연이 추가로 발생합니다. 따라서 실제 지연 시간은 전파 지연 시간보다 더 길어질 수 있습니다.

이러한 이유로, 네트워크 성능을 최적화하기 위해서는 전송 지연, 처리 지연, 큐잉 지연 등 다양한 지연 요소를 고려해야 합니다. 또한, 데이터 전송 속도를 높이기 위해 대역폭을 늘리는 것도 중요합니다. 그러나 대역폭을 늘리는 것만으로는 지연 시간을 줄일 수 없으므로, 지연 시간을 줄이기 위한 다양한 기술과 전략이 필요합니다.

빛의 속도는 매우 빠르지만, 뉴욕에서 시드니까지 데이터 패킷이 왕복(RTT, Round-Trip Time)하는 데 **160ms**가 걸립니다. 그러나 이는 이론적으로 가장 짧은 거리(대원형 경로, great-circle path)를 따라 **광섬유 케이블**을 통해 이동한다고 가정한 값이며, 실제로는 그렇지 않습니다.

현실에서는 패킷이 여러 **라우터와 네트워크 노드를 거쳐 우회 경로**를 따라 이동하게 되며, 이 과정에서 **라우팅, 처리, 대기(큐잉), 전송 지연** 등이 추가됩니다. 결과적으로 **실제 RTT는 200~300ms** 수준이 됩니다.

이 속도는 기술적으로는 매우 빠르지만, **사람의 인지 속도**를 고려하면 다르게 해석할 수 있습니다. 연구에 따르면:

- **100~200ms 이상의 지연**이 발생하면 사람들은 이를 "느려졌다"고 인식하기 시작함
- **300ms 이상**이 되면 "반응이 둔하다"는 평가가 많아짐
- **1초(1,000ms) 이상 지연**되면, 사용자는 기다리는 동안 "멘탈 컨텍스트 스위치(mental context switch)"를 수행하여, 집중력이 다른 곳으로 이동하는 경향이 있음

즉, 기술적으로 보면 빠른 속도라 해도, **사람이 지연을 인지하는 한계치**를 넘어서면 사용자 경험이 크게 저하될 수 있습니다.

...

---

## 대역폭과 지연 시간 개선 방법 (Delivering Higher Bandwidth and Lower Latencies)

### 대역폭 증가 방법

1. 광섬유 케이블 추가 설치 → 네트워크 용량 확장
2. 혼잡한 경로에 추가 링크 구축 → 트래픽 분산
3. 파장 분할 다중화(Wavelength Division Multiplexing, WDM) 기술 개선 → 같은 광섬유에서 더 많은 데이터를 전송

실제로 2011년 기준, 대서양 횡단 해저 케이블의 전체 용량 중 약 20%만 사용되고 있었으며, 2007~2011년 사이 추가된 용량의 절반 이상이 WDM 기술 업그레이드를 통해 확보되었습니다. 즉, 기존 네트워크의 대역폭을 더 효과적으로 활용하는 방법도 있습니다.

### 지연 시간 감소 방법

반면, 지연 시간 감소는 물리적인 한계로 인해 더 어려운 문제입니다. 빛의 속도가 절대적인 한계를 가지기 때문에, 다음과 같은 네트워크 최적화 기법이 필요합니다.

- 라운드 트립(왕복) 횟수 줄이기
  - TCP/IP 프로토콜 최적화, HTTP/3 등 새로운 프로토콜 도입
- 데이터를 사용자 가까이에 배치
  - CDN(Content Delivery Network) 사용
  - 엣지 컴퓨팅(Edge Computing) 활용
- 캐싱 및 사전 로딩 (Pre-fetching) 활용
  - 자주 사용되는 데이터를 미리 저장하여 요청 시 바로 제공
